@{
    Layout = null;
}
@using EAD_project.Controllers
@model UserViewModel

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MessHub - My Dashboard</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/userdashboard.css">
</head>
<body>

    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3><i class="bi bi-egg-fried me-2"></i>MessHub</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="@Url.Action("user_dashboard","Userdashboard")" class="nav-link active"><i class="bi bi-grid-1x2-fill"></i> My Dashboard</a>
                <a href="@Url.Action("user_attendance", "Userattendance")" class="nav-link"><i class="bi bi-calendar-check-fill"></i> My Attendance</a>
                <a href="@Url.Action("user_bill","Bill_user")" class="nav-link"><i class="bi bi-receipt"></i> My Bills</a>
                <a href="@Url.Action("user_menu","Usermenu")" class="nav-link"><i class="bi bi-journal-text"></i> Menu</a>
                <a href="@Url.Action("user_dispute", "Userdispute")" class="nav-link"><i class="bi bi-exclamation-triangle-fill"></i> My Disputes</a>
                <a href="@Url.Action("user_profile", "Userprofile")" class="nav-link"><i class="bi bi-person-circle"></i> Profile</a>
            </nav>
            <div class="sidebar-footer">
                <a href="@Url.Action("logout", "Logout")" class="nav-link"><i class="bi bi-box-arrow-left"></i> Logout</a>
            </div>
        </aside>

        <!-- Sidebar Overlay for Mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Navbar -->
            <header class="top-navbar">
                <button class="btn sidebar-toggle d-lg-none" id="sidebarToggle">
                    <i class="bi bi-list"></i>
                </button>
                <h4 class="page-title">My Dashboard</h4>
                <div class="navbar-right">
                    <span class="user-greeting">Welcome, <strong id="userName">Ahmed Ali</strong></span>
                    <div class="user-avatar">
                        <i class="bi bi-person-circle"></i>
                    </div>
                </div>
            </header>

             <!-- Dashboard Content --> 
            <div class="dashboard-content"> 
                <!-- Welcome Banner --> 
                <div class="welcome-banner mb-4"> 
                    <div class="welcome-content"> 
                        <h2>Welcome Back, <span id="userNameBanner">Ahmed Ali</span>! </h2> 
                       <p>Here's your mess activity summary for this month</p> 
                    </div> 
                   <div class="welcome-date">
                        <i class="bi bi-calendar3"></i> 
                        <span id="currentDate">December 20, 2025</span> 
                     </div>
                 </div>
            </div>
            @*     <!-- Stats Cards --> *@
            @*     <div class="row g-4 mb-4"> *@
            @*         <div class="col-12 col-sm-6 col-xl-3"> *@
            @*             <div class="stat-card"> *@
            @*                 <div class="stat-icon bg-primary-light"> *@
            @*                     <i class="bi bi-calendar-check-fill text-primary"></i> *@
            @*                 </div> *@
            @*                 <div class="stat-info"> *@
            @*                     <h3 id="totalAttendance">0</h3> *@
            @*                     <p>Total Attendance</p> *@
            @*                     <small class="text-muted">This Month</small> *@
            @*                 </div> *@
            @*             </div> *@
            @*         </div> *@
            @*         <div class="col-12 col-sm-6 col-xl-3"> *@
            @*             <div class="stat-card"> *@
            @*                 <div class="stat-icon bg-success-light"> *@
            @*                     <i class="bi bi-percent text-success"></i> *@
            @*                 </div> *@
            @*                 <div class="stat-info"> *@
            @*                     <h3 id="attendanceRate">0%</h3> *@
            @*                     <p>Attendance Rate</p> *@
            @*                     <small class="text-muted">This Month</small> *@
            @*                 </div> *@
            @*             </div> *@
            @*         </div> *@
            @*         <div class="col-12 col-sm-6 col-xl-3"> *@
            @*             <div class="stat-card"> *@
            @*                 <div class="stat-icon bg-warning-light"> *@
            @*                     <i class="bi bi-egg-fried text-warning"></i> *@
            @*                 </div> *@
            @*                 <div class="stat-info"> *@
            @*                     <h3 id="mealCount">0</h3> *@
            @*                     <p>Meals Taken</p> *@
            @*                     <small class="text-muted">This Month</small> *@
            @*                 </div> *@
            @*             </div> *@
            @*         </div> *@
            @*         <div class="col-12 col-sm-6 col-xl-3"> *@
            @*             <div class="stat-card"> *@
            @*                 <div class="stat-icon bg-danger-light"> *@
            @*                     <i class="bi bi-currency-rupee text-danger"></i> *@
            @*                 </div> *@
            @*                 <div class="stat-info"> *@
            @*                     <h3 id="currentBill">Rs. 0</h3> *@
            @*                     <p>Current Bill</p> *@
            @*                     <small class="text-muted">This Month</small> *@
            @*                 </div> *@
            @*             </div> *@
            @*         </div> *@
            @*     </div> *@

                <!-- Main Content Grid -->
                <div class="row g-4">
                    <!-- Today's Menu -->
                    <div class="col-12 col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-cup-hot-fill me-2"></i>Today's Menu</h5>
                                <span class="badge bg-success" id="todayDay">Friday</span>
                            </div>
                            <div class="card-body">
                                <!-- Lunch -->
                                <div class="meal-section">
                                    <div class="meal-header">
                                        <div class="meal-title">
                                            <i class="bi bi-brightness-high-fill text-warning"></i>
                                            <span>Lunch</span>
                                        </div>
                                        <span class="meal-price" id="lunchPrice">Rs. 0</span>
                                    </div>
                                    <ul class="menu-items" id="lunchItems">
                                        <li>Loading...</li>
                                    </ul>
                                </div>
                                <!-- Dinner -->
                                <div class="meal-section">
                                    <div class="meal-header">
                                        <div class="meal-title">
                                            <i class="bi bi-moon-fill text-primary"></i>
                                            <span>Dinner</span>
                                        </div>
                                        <span class="meal-price" id="dinnerPrice">Rs. 0</span>
                                    </div>
                                    <ul class="menu-items" id="dinnerItems">
                                        <li>Loading...</li>
                                    </ul>
                                </div>
                                <!-- Total -->
                                <div class="day-total">
                                    <span>Today's Total:</span>
                                    <strong id="todayTotal">Rs. 0</strong>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Bills -->
                    <div class="col-12 col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="bi bi-receipt me-2"></i>Recent Bills</h5>
                                <a href="#" class="view-all-link">View All</a>
                            </div>
                            <div class="card-body">
                                <div class="bill-list" id="recentBills">
                                    <!-- Bills will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <!-- 1. C# Variables to JavaScript -->
<script>
    // User Profile
    let currentUser = {
        userId: @Model.user.UserId,
        name: "@Model.user.Name",
        username: "@Model.user.Username",
        department: "@Model.user.Department",
        cnic: "@Model.user.Cnic"
    };

    // Attendance List
    let attendances = @Html.Raw(Json.Serialize(Model.attendance.Select(a => new
            {
                attendanceId = a.AttendanceId,
                attendanceDate = a.AttendanceDate,
                mealType = a.MealType,
                teaWater = a.TeaWater,
                food = a.Food,
                foodPrice = a.FoodPrice
            })));

    // Bills List (Paid & Unpaid)
    let bill = @Html.Raw(Json.Serialize(Model.bill.Select(b => new
            {
                billId = b.BillId,
                month = b.Month,
                year = b.Year,
                grandTotal = b.GrandTotal,
                isPaid = b.IsPaid
            })));

    // Menu List
    let menu = @Html.Raw(Json.Serialize(Model.menu));
</script>

    <script src="~/js/userdashboard.js"></script>
</body>
</html>
